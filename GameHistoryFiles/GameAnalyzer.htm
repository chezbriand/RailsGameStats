<!DOCTYPE html>
<html>
<head>
    <title>Game Analyzer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <textarea id="inputArea" rows="10" cols="50"></textarea><br>
    <button onclick="analyzeGame()">Analyze</button>
    <canvas id="myChart"></canvas>

    <script>
        function analyzeGame() {
            var text = document.getElementById('inputArea').value;
            var lines = text.trim().split('\n').reverse();
            var players = {};
            var startingMoney = 60; // Change this to the starting money amount
            var currentRound = null;
            var totalRounds = 0;

            lines.forEach(line => {
                var parts = line.split('\t');
                var round = parts[0];
                var player = parts[1];
                var action = parts[2];

                if (!players[player]) {
                    players[player] = { money: startingMoney, history: [] };
                }

                var moneyChange = 0;
                if (action.startsWith('Built') || action.startsWith('Upgraded')) {
                    var amount = action.match(/\$([0-9]+)/)[1];
                    moneyChange = -amount;
                } else if (action.startsWith('Delivered')) {
                    var amount = action.match(/\$([0-9]+)/)[1];
                    moneyChange = +amount;
                }

                players[player].money += moneyChange;

                // If we've moved to the next round, update the history for all players
                if (round !== currentRound) {
                    for (var p in players) {
                        players[p].history.push(players[p].money);
                    }
                    currentRound = round;
                    totalRounds++;
                }
            });

            var datasets = [];
            for (var player in players) {
                datasets.push({
                    label: player,
                    data: players[player].history,
                    fill: false,
                    borderColor: '#' + Math.floor(Math.random()*16777215).toString(16), // Random color
                });
            }

            var ctx = document.getElementById('myChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array(totalRounds).fill().map((_, i) => i + 1), // Rounds
                    datasets: datasets,
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: 'Player Money Over Time'
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Round'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Money'
                            }
                        }]
                    }
                }
            });
        }
    </script>
</body>
</html>
